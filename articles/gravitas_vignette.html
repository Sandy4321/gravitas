<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exploring probability distributions for bivariate temporal granularities • gravitas</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Exploring probability distributions for bivariate temporal granularities">
<meta property="og:description" content="gravitas">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gravitas</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/gravitas_vignette.html">Temporal study</a>
    </li>
    <li>
      <a href="../articles/cricket.html">Non-temporal study</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Sayani07/gravitas/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Exploring probability distributions for bivariate temporal granularities</h1>
                        <h4 class="author">Sayani Gupta
<hr>
</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Sayani07/gravitas/blob/master/vignettes/gravitas_vignette.Rmd"><code>vignettes/gravitas_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>gravitas_vignette.Rmd</code></div>

    </div>

    
    
<!-- #Example vignette: 
https://github.com/njtierney/naniar/blob/master/vignettes/getting-started-w-naniar.Rmd -->
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Temporal data are available at various resolutions depending on the context. Often in time series analysis, data collected at finer scales needs to be explored also at coarser temporal scales. This approach requires deconstructing time in various possible ways leading to linear (e.g. days, weeks), circular (e.g. day-of-week) or aperiodic (e.g. day-of-month) time granularities. The hierarchical structure of time also creates a natural nested ordering resulting in single or multiple order-up granularities. For a conventional Gregorian calendar, examples of single-order-up granularity include hour-of-day and minute-of-hour, while examples of multiple-order-up granularity may include hour-of-week or minute-of-day. All of these granularities might be useful in throwing light on the periodicity of the data.</p>
<p>Exploration of large quantities of temporal data across so many different deconstructions of time becomes clumsy without a systematic approach.</p>
<p>This vignette describes the tools in the package <code>gravitas</code> for systematically exploring large quantities of temporal data across different time deconstructions by visualizing the probability distributions using a range of graphics in <code>ggplot2</code>.</p>
</div>
<div id="analysis-of-smart-meter-data" class="section level1">
<h1 class="hasAnchor">
<a href="#analysis-of-smart-meter-data" class="anchor"></a>Analysis of smart meter data</h1>
<p>The <code>smart_meter10</code> data set in the package is a <a href="https://tsibble.tidyverts.org/">tsibble</a> providing the energy consumption for ten households from <a href="https://data.gov.au/dataset/ds-dga-4e21dea3-9b87-4610-94c7-15a8a77907ef/details?q=smart-meter">customer trials</a>. It is hard to derive insights when we try to visualize periodicity in the data for all households. For example, if we plot the energy consumption across each hour of the day, the structure of the data suggests that there are several data points for each hour of the day for just one household. Hence, for several households, there will be a blob of points for each hour of the day.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">smart_meter10</span> <span class="kw">%&gt;%</span> <span class="fu">select</span>(<span class="no">customer_id</span>,
                         <span class="no">reading_datetime</span>,
                         <span class="no">general_supply_kwh</span>,
                         <span class="fu">everything</span>()
)
<span class="co">#&gt; # A tsibble: 259,235 x 3 [30m] &lt;UTC&gt;</span>
<span class="co">#&gt; # Key:       customer_id [10]</span>
<span class="co">#&gt;    customer_id reading_datetime    general_supply_kwh</span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;dttm&gt;                           &lt;dbl&gt;</span>
<span class="co">#&gt;  1 10006704    2012-06-01 10:00:00              0.24 </span>
<span class="co">#&gt;  2 10006704    2012-06-01 10:30:00              0.245</span>
<span class="co">#&gt;  3 10006704    2012-06-01 11:00:00              0.206</span>
<span class="co">#&gt;  4 10006704    2012-06-01 11:30:00              0.217</span>
<span class="co">#&gt;  5 10006704    2012-06-01 12:00:00              0.214</span>
<span class="co">#&gt;  6 10006704    2012-06-01 12:30:00              0.23 </span>
<span class="co">#&gt;  7 10006704    2012-06-01 13:00:00              0.898</span>
<span class="co">#&gt;  8 10006704    2012-06-01 13:30:00              0.197</span>
<span class="co">#&gt;  9 10006704    2012-06-01 14:00:00              0.255</span>
<span class="co">#&gt; 10 10006704    2012-06-01 14:30:00              0.199</span>
<span class="co">#&gt; # … with 259,225 more rows</span></pre></body></html></div>
<!-- To have an understanding of how different the energy consumption for each household of the trial is, energy consumption is plotted against time with each transition state indicating one household for a sample. If we plot the raw data for all of them, it is difficult to get insights into their behavior.  -->
<!-- # ```{r, echo=FALSE, out.width="100%"} -->
<!-- # # smart_p <- smart_meter10 %>% -->
<!-- # #            ggplot() + -->
<!-- # #            geom_line(aes(x =reading_datetime, -->
<!-- # #                          y = general_supply_kwh, -->
<!-- # #                          color = customer_id))  + -->
<!-- # #   theme(legend.position = "None") -->
<!-- # # -->
<!-- # # smart_anim <-  smart_p + gganimate::transition_states(customer_id)+ labs(title = "{closest_state}") -->
<!-- # # -->
<!-- # # gganimate::animate(smart_anim, fps = 10, width = 1000, height = 600) -->
<!-- # # -->
<!-- # # -->
<!-- # # anim_save("images/smart_allcust.gif") -->
<!-- # -->
<!-- # knitr::include_graphics("man/figures/smart_allcust_period.gif") -->
<!-- # ``` -->
<p>So the question is how to explore systematically multiple perspectives of this smart meter data across different time granularities to find regular patterns or anomalies in behaviors? One way can be by visualizing the probability distributions across these granularities.</p>
<p>Let us see how we can explore the energy behavior of a couple of households by making allowances for the following aspects of time granularities: Computation, interaction and visualization.</p>
<div id="computation" class="section level2">
<h2 class="hasAnchor">
<a href="#computation" class="anchor"></a>Computation</h2>
<div id="get-set-of-possible-granularities-with-search_gran" class="section level3">
<h3 class="hasAnchor">
<a href="#get-set-of-possible-granularities-with-search_gran" class="anchor"></a>Get set of possible granularities with <code>search_gran</code>
</h3>
<p>Typically, the first thing we should have at our disposal for examining periodicities of energy behavior across time granularities is to know the number of time granularities we can look at exhaustively. If we consider conventional time deconstructions for a Gregorian calendar (second, minute, half-hour, hour, day, week, fortnight, month, quarter, semester, year), the following time granularities can be considered for this analysis.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tsibble</span>)
<span class="fu"><a href="https://tsibble.tidyverts.org/reference/regular.html">interval</a></span>(<span class="no">smart_meter10</span>)
<span class="co">#&gt; 30m</span>
<span class="no">smart_meter10</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/search_gran.html">search_gran</a></span>()
<span class="co">#&gt;  [1] "hhour_hour"         "hhour_day"          "hhour_week"        </span>
<span class="co">#&gt;  [4] "hhour_fortnight"    "hhour_month"        "hhour_quarter"     </span>
<span class="co">#&gt;  [7] "hhour_semester"     "hhour_year"         "hour_day"          </span>
<span class="co">#&gt; [10] "hour_week"          "hour_fortnight"     "hour_month"        </span>
<span class="co">#&gt; [13] "hour_quarter"       "hour_semester"      "hour_year"         </span>
<span class="co">#&gt; [16] "day_week"           "day_fortnight"      "day_month"         </span>
<span class="co">#&gt; [19] "day_quarter"        "day_semester"       "day_year"          </span>
<span class="co">#&gt; [22] "week_fortnight"     "week_month"         "week_quarter"      </span>
<span class="co">#&gt; [25] "week_semester"      "week_year"          "fortnight_month"   </span>
<span class="co">#&gt; [28] "fortnight_quarter"  "fortnight_semester" "fortnight_year"    </span>
<span class="co">#&gt; [31] "month_quarter"      "month_semester"     "month_year"        </span>
<span class="co">#&gt; [34] "quarter_semester"   "quarter_year"       "semester_year"</span></pre></body></html></div>
<p>The interval of this tsibble is 30 minutes, and hence the default for <code>search_gran</code> in this case, provides temporal granularities ranging from half-hour to year. If these options are considered too many, the default options can be modified to limit the possibilities. For example, the most coarse temporal unit can be set to be a “month”.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r">
<span class="no">smart_meter10</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/search_gran.html">search_gran</a></span>(<span class="kw">highest_unit</span> <span class="kw">=</span> <span class="st">"month"</span>)
<span class="co">#&gt;  [1] "hhour_hour"      "hhour_day"       "hhour_week"      "hhour_fortnight"</span>
<span class="co">#&gt;  [5] "hhour_month"     "hour_day"        "hour_week"       "hour_fortnight" </span>
<span class="co">#&gt;  [9] "hour_month"      "day_week"        "day_fortnight"   "day_month"      </span>
<span class="co">#&gt; [13] "week_fortnight"  "week_month"      "fortnight_month"</span></pre></body></html></div>
<p>This looks better. However, some intermediate temporal units might not be pertinent to the analysis and we might want to remove them from the list of granularities that we want to examine using the argument <code>filter_out</code> in <code>search_gran</code>.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r">
<span class="no">smart_meter10</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/search_gran.html">search_gran</a></span>(<span class="kw">highest_unit</span> <span class="kw">=</span> <span class="st">"month"</span>,
                              <span class="kw">filter_out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"hhour"</span>, <span class="st">"fortnight"</span>)
)
<span class="co">#&gt; [1] "hour_day"   "hour_week"  "hour_month" "day_week"   "day_month" </span>
<span class="co">#&gt; [6] "week_month"</span></pre></body></html></div>
</div>
<div id="create-any-temporal-granularity-with-create_gran" class="section level3">
<h3 class="hasAnchor">
<a href="#create-any-temporal-granularity-with-create_gran" class="anchor"></a>Create any temporal granularity with <code>create_gran()</code>
</h3>
<p>After we have the set of granularities to look at, we should be able to compute any granularity using <code>create_gran</code>. These can be be used for exploring the distribution of the time series across univariate temporal granularity or computing summary statistics across these categorizations.</p>
<p>The data is filtered for two customers and a new granularity “day_fortnight” (day of the fortnight) is created and visualized to understand if the electricity consumption is different across days of the fortnight. From the <a href="https://amstat.tandfonline.com/doi/abs/10.1080/10618600.2017.1305277?journalCode=ucgs20#.XbOwLpMzZ24">letter value plot</a>, we can not clearly observe any pattern across days of the fortnight for each household.</p>
<p>The difference in the distribution of energy consumption for these two households can be observed in the following plot. Let us see if we can derive any other insights than the otherwise obvious observation that in most cases the second household has much less consumption than the first one. If we consider letter value F as a regular behavior and letter values beyond F as not-so-regular behavior, we can conclude that the regular behavior of the first household is more stable than the second household. However, the distribution of tail of the first household is more variable, observed through distinct letter values, implying that their not-so-regular behavior is quite extreme.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lvplot</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="no">smart_meter10</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">customer_id</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10006704</span>, <span class="fl">10017936</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/create_gran.html">create_gran</a></span>(<span class="st">"day_fortnight"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(
    <span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">day_fortnight</span>),
    <span class="kw">y</span> <span class="kw">=</span> <span class="no">general_supply_kwh</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"day_fortnight"</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/lvplot/man/geom_lv.html">geom_lv</a></span>(
    <span class="kw">outlier.colour</span> <span class="kw">=</span> <span class="st">"red"</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">..LV..</span>),
    <span class="kw">k</span> <span class="kw">=</span> <span class="fl">5</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">customer_id</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/lvplot/man/geom_lv.html">scale_fill_lv</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_sqrt</a></span>()</pre></body></html></div>
<p><img src="gravitas_vignette_files/figure-html/unnamed-chunk-1-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="interaction" class="section level2">
<h2 class="hasAnchor">
<a href="#interaction" class="anchor"></a>Interaction</h2>
<p>We can visualize the distribution of energy across univariate time granularities for deriving insights on periodic behavior. From the search list, we found that we can look at six granularities, that amounts to analyzing six graphics. However, what happens if we want to see the distribution of energy across two granularities at a time? This is equivalent to looking at the distribution of energy consumption across one granularity conditional on another one. One way can be to plot one of the granularities on the x-axis and another on the facet. Different perspectives of the data can be derived depending on where the granularities are places.</p>
<p>So, what is the number of pairs of granularities we can look at? It is equivalent to taking 2 granularities from 6, which essentially means we need to examine 30 plots. The good news is, not all time granularities can be plotted together and we do not have to analyze so many plots!</p>
<p>Harmony/clash can be identified to considerably reduce the number of visualizations that can aid exploratory analysis.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">smart_meter10</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/is_harmony.html">is_harmony</a></span>(<span class="kw">gran1</span> <span class="kw">=</span> <span class="st">"hour_day"</span>,
             <span class="kw">gran2</span> <span class="kw">=</span> <span class="st">"day_week"</span>)
<span class="co">#&gt; [1] "TRUE"</span>

<span class="no">smart_meter10</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/is_harmony.html">is_harmony</a></span>(<span class="kw">gran1</span> <span class="kw">=</span> <span class="st">"hour_day"</span>,
             <span class="kw">gran2</span> <span class="kw">=</span> <span class="st">"day_week"</span>,
             <span class="kw">facet_h</span> <span class="kw">=</span> <span class="fl">14</span>)
<span class="co">#&gt; [1] "FALSE"</span>

<span class="no">smart_meter10</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/is_harmony.html">is_harmony</a></span>(<span class="kw">gran1</span> <span class="kw">=</span> <span class="st">"day_month"</span>,
             <span class="kw">gran2</span> <span class="kw">=</span> <span class="st">"week_month"</span>)
<span class="co">#&gt; [1] "FALSE"</span></pre></body></html></div>
<p>Let us now look at all the harmonies that we can examine. Fortunately, we are left with only 13 out of 30 visualizations. We can also play with the argument <code>facet_h</code>, which represents the maximum number of levels allowed for the facet variable, to reduce or increase the number of harmonies.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">smart_meter10</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/harmony.html">harmony</a></span>(
  <span class="kw">ugran</span> <span class="kw">=</span> <span class="st">"month"</span>,
  <span class="kw">filter_out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"hhour"</span>, <span class="st">"fortnight"</span>)
)
<span class="co">#&gt; # A tibble: 10 x 4</span>
<span class="co">#&gt;    facet_variable x_variable facet_levels x_levels</span>
<span class="co">#&gt;    &lt;chr&gt;          &lt;chr&gt;             &lt;int&gt;    &lt;int&gt;</span>
<span class="co">#&gt;  1 day_week       hour_day              7       24</span>
<span class="co">#&gt;  2 day_month      hour_day             31       24</span>
<span class="co">#&gt;  3 week_month     hour_day              5       24</span>
<span class="co">#&gt;  4 hour_day       day_week             24        7</span>
<span class="co">#&gt;  5 day_month      day_week             31        7</span>
<span class="co">#&gt;  6 week_month     day_week              5        7</span>
<span class="co">#&gt;  7 hour_day       day_month            24       31</span>
<span class="co">#&gt;  8 day_week       day_month             7       31</span>
<span class="co">#&gt;  9 hour_day       week_month           24        5</span>
<span class="co">#&gt; 10 day_week       week_month            7        5</span></pre></body></html></div>
</div>
<div id="visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#visualization" class="anchor"></a>Visualization</h2>
<p>Now, we know the pairs of granularities that we need to look at using harmonies. Next, we want to visualize the distribution of the measured variable <code>general_supply_kwh</code> across these harmonies. This is possible through <code>prob_plot</code>. We have several options for visualizing statistical distributions and each comes with some pros and cons which we need to consider while choosing a good one for our context. Traditional methods of plotting distributions include boxplots and violin plots, while more recent methods include ridge plots, quantile plots or letter-value plots.</p>
<p><code>gran_advice</code> provides checkpoints before plotting a distribution. It includes recommended distribution plots depending on the levels of the two granularities plotted. Assumptions are made to ensure the display is not too cluttered by the space occupied by various kinds of distribution plots. Moreover, it also provides advice on the number of observations to use for drawing the distribution plot so that one can ensure that they are enough before jumping on to plot a distribution. Furthermore, it advises if the number of observations varies significantly across facets or within facets.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">smart_meter10</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/gran_advice.html">gran_advice</a></span>(
  <span class="st">"week_month"</span>,
  <span class="st">"hour_day"</span>
)
<span class="co">#&gt; The chosen granularities are harmonies </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Recommended plots are: violin lv quantile boxplot </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Number of observations are homogenous across facets </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Number of observations are homogenous within facets </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Cross tabulation of granularities : </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; # A tibble: 24 x 6</span>
<span class="co">#&gt;    hour_day   `1`   `2`   `3`   `4`   `5`</span>
<span class="co">#&gt;    &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 0         2474  2464  2518  2489   857</span>
<span class="co">#&gt;  2 1         2470  2470  2518  2486   854</span>
<span class="co">#&gt;  3 2         2469  2469  2520  2486   855</span>
<span class="co">#&gt;  4 3         2468  2468  2522  2486   856</span>
<span class="co">#&gt;  5 4         2467  2468  2521  2486   856</span>
<span class="co">#&gt;  6 5         2468  2468  2520  2487   856</span>
<span class="co">#&gt;  7 6         2470  2469  2519  2486   855</span>
<span class="co">#&gt;  8 7         2470  2472  2518  2484   854</span>
<span class="co">#&gt;  9 8         2470  2471  2519  2479   854</span>
<span class="co">#&gt; 10 9         2470  2470  2520  2478   856</span>
<span class="co">#&gt; # … with 14 more rows</span></pre></body></html></div>
<p>The function <code>gran_obs</code> can be employed to see if the number of observations per category is large enough to draw a distribution plot. In this case, the number of observations is much less on weekends compared to weekdays, but enough to have reliable estimates of distribution.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">smart_meter10</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/gran_obs.html">gran_obs</a></span>(
  <span class="st">"week_month"</span>,
  <span class="st">"wknd_wday"</span>
)
<span class="co">#&gt; # A tibble: 2 x 6</span>
<span class="co">#&gt;   wknd_wday   `1`   `2`   `3`   `4`   `5`</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Weekday   42348 42195 43144 42468 14695</span>
<span class="co">#&gt; 2 Weekend   17008 17024 17347 17094  5912</span></pre></body></html></div>
<p>Through <code>prob_plot</code> we can choose one from the list of recommended plots. Warnings are generated if users try to plot clashes, the number of facet variables is too high or the number of observations used to compute statistical summaries for distribution is not large enough. Currently, we can choose from “boxplot”, “violin”, “ridge”, “lv” or “quantile” to visualize distributions.</p>
<p>We visualize the harmony pair (wknd_wday, hour_day) through a box plot. Boxplot of energy consumption is shown across wknd_wday (facet) and hour-day (x-axis) for the same two households. For the second household, outliers are less prominent implying their regular behavior is more stable. For the first household, energy behavior is not significantly different between weekdays and weekends. For the second household, median energy consumption for the early morning hours is extremely high for weekends compared to weekdays.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">cust1</span> <span class="kw">&lt;-</span> <span class="no">smart_meter10</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">customer_id</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10006704</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/prob_plot.html">prob_plot</a></span>(<span class="st">"wknd_wday"</span>,
                            <span class="st">"hour_day"</span>,
                            <span class="kw">response</span> <span class="kw">=</span> <span class="st">"general_supply_kwh"</span>,
                            <span class="kw">plot_type</span> <span class="kw">=</span> <span class="st">"boxplot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_sqrt</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Energy consumption distribution for customer id: 10006704"</span>)
<span class="co">#&gt; Joining, by = c("wknd_wday", "hour_day")</span>
<span class="co">#&gt; Warning: Column `wknd_wday` joining character vector and factor, coercing into</span>
<span class="co">#&gt; character vector</span>
<span class="co">#&gt; Joining, by = c("wknd_wday", "hour_day")</span>
<span class="co">#&gt; Warning: Column `wknd_wday` joining character vector and factor, coercing into</span>
<span class="co">#&gt; character vector</span></pre></body></html></div>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">cust2</span> <span class="kw">&lt;-</span> <span class="no">smart_meter10</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">customer_id</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10017936</span>))<span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/prob_plot.html">prob_plot</a></span>(<span class="st">"wknd_wday"</span>,
                            <span class="st">"hour_day"</span>,
                            <span class="kw">response</span> <span class="kw">=</span> <span class="st">"general_supply_kwh"</span>,
                            <span class="kw">plot_type</span> <span class="kw">=</span> <span class="st">"boxplot"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_sqrt</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Energy consumption distribution for customer id: 10017936"</span>)
<span class="co">#&gt; Joining, by = c("wknd_wday", "hour_day")</span>
<span class="co">#&gt; Warning: Column `wknd_wday` joining character vector and factor, coercing into</span>
<span class="co">#&gt; character vector</span>
<span class="co">#&gt; Joining, by = c("wknd_wday", "hour_day")</span>
<span class="co">#&gt; Warning: Column `wknd_wday` joining character vector and factor, coercing into</span>
<span class="co">#&gt; character vector</span></pre></body></html></div>
<p><img src="gravitas_vignette_files/figure-html/cust-1.png" width="768" style="display: block; margin: auto;"><img src="gravitas_vignette_files/figure-html/cust-2.png" width="768" style="display: block; margin: auto;"></p>
<p>Similarly, we can plot the other harmony pairs and decide if they are useful in deriving insights about the energy behavior of the customers.</p>
</div>
<div id="future-development" class="section level2">
<h2 class="hasAnchor">
<a href="#future-development" class="anchor"></a>Future development</h2>
<ul>
<li><p>To develop a framework so that these individual distributions are utilized to group subjects into similar pockets of behavior.</p></li>
<li><p>Make <code>gravitas</code> work with big data tools like <code>sparklyr</code></p></li>
<li><p>Any periodic/aperiodic temporal granularities computation given a hierarchical structure/calendar.</p></li>
</ul>
</div>
<div id="acknowledgements" class="section level2">
<h2 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h2>
<p>Thanks to PhD supervisors <a href="https://robjhyndman.com/">Prof. Rob J Hyndman</a>, <a href="http://dicook.org/">Prof. Dianne Cook</a> and <a href="https://summerofcode.withgoogle.com/">Google Summer of Code 2019</a> mentor <a href="http://rosuda.org/~unwin/">Prof. Antony Unwin</a> for their support and always leading by example. The fine balance of encouraging me to work on my ideas and stepping in to help when I need has made the development of this package a great learning experience for me.</p>
<p>Moreover, I want to thank my cohort at <a href="https://www.monash.edu/news/articles/team-profile-monash-business-analytics-team">NUMBATS</a>, Monash University, especially <a href="https://www.mitchelloharawild.com/">Mitchell O’Hara-Wild</a> and <a href="https://github.com/nspyrison">Nicholas Spyrison</a> for always lending an ear and sharing their wisdom and experience of developing R packages, with such kindness.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sayani Gupta, Rob Hyndman, Di Cook, Antony Unwin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '',
    indexName: 'gravitas',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
